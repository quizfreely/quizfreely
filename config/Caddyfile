quizfreely.org {
        encode zstd gzip

        handle_path /api/* {
            reverse_proxy localhost:8008
        }
        handle_path /realtime/* {
            reverse_proxy localhost:8000
        }

        handle_path /docs* {
            root * /srv/quizfreely-docs/www
            file_server

            handle_errors {
                @notfound expression {http.error.status_code} == 404
                rewrite @notfound /404.html
                file_server
            }
        }

        @immutable {
                path /immutable/*
                path /_app/immutable/*
        }
        handle @immutable {
                root * /srv/quizfreely-web/www
                file_server
                header {
                        Cache-Control "public, max-age=31536000, immutable"
                }
        }
        handle /_app/* {
                root * /srv/quizfreely-web/www
                file_server
        }

        handle {
            reverse_proxy localhost:8080
        }

        redir /discord https://discord.gg/6qQrybf6kG
}
www.quizfreely.org, quizfreely.com, www.quizfreely.com {
        redir https://quizfreely.org{uri} permanent
}
